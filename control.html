<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bull Team Mobile Control</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 1.8em;
      margin-bottom: 10px;
      font-weight: 300;
    }

    .header p {
      opacity: 0.8;
      font-size: 0.9em;
    }

    .controls {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 25px;
      backdrop-filter: blur(10px);
      margin-bottom: 20px;
    }

    .control-section {
      margin-bottom: 25px;
    }

    .control-section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 1.1em;
      margin-bottom: 15px;
      color: #f8f9fa;
      font-weight: 500;
    }

    .nav-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 12px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s ease;
      text-align: center;
      font-weight: 500;
    }

    .btn:hover, .btn:active {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .btn-primary {
      background: rgba(52, 152, 219, 0.6);
      border-color: rgba(52, 152, 219, 0.8);
    }

    .btn-primary:hover {
      background: rgba(52, 152, 219, 0.8);
    }

    .slide-info {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 20px;
    }

    .slide-number {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .slide-title {
      font-size: 0.9em;
      opacity: 0.8;
    }

    .link-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }

    .link-section a {
      color: #74b9ff;
      text-decoration: none;
      font-weight: 500;
    }

    .link-section a:hover {
      text-decoration: underline;
    }

    .status {
      font-size: 0.8em;
      opacity: 0.7;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Bull Team</h1>
      <p>Digital Innovation Presentation Control</p>
    </div>

      <div class="slide-info">
        <div class="slide-number">Slide <span id="current-slide">1</span> of <span id="total-slides">20+</span></div>
        <div class="slide-title" id="slide-title">Loading...</div>
      </div>

      <div class="controls">
        <div class="control-section">
          <div class="section-title">Navigation</div>
          <div class="nav-buttons">
            <button class="btn" onclick="previousSlide()">‚Üê Previous</button>
            <button class="btn" onclick="nextSlide()">Next ‚Üí</button>
            <button class="btn" onclick="upSlide()">‚Üë Up</button>
            <button class="btn" onclick="downSlide()">‚Üì Down</button>
          </div>
          <div class="nav-buttons">
            <button class="btn" onclick="firstSlide()">First</button>
            <button class="btn" onclick="lastSlide()">Last</button>
          </div>
        </div>      <div class="control-section">
        <div class="section-title">Presentation</div>
        <div class="nav-buttons">
          <button class="btn btn-primary" onclick="toggleOverview()">Overview</button>
          <button class="btn btn-primary" onclick="toggleBlackout()">Blackout</button>
          <button class="btn" onclick="resetView()">Reset</button>
          <button class="btn" onclick="toggleNotes()">Notes</button>
        </div>
      </div>
    </div>

    <div class="link-section">
      <div class="section-title">Quick Links</div>
      <p><a href="index.html" target="_blank">üéØ Main Presentation</a></p>
      <p><a href="https://github.com/aiegoo/oreumi-bull4team" target="_blank">üìÅ Team Repository</a></p>
      <div class="status" id="connection-status">Connecting...</div>
    </div>
  </div>

  <script>
    // Presentation control functions
    let mainWindow = null;
    let isConnected = false;
    
    function connectToPresentation() {
      // Try to connect to existing window or open new one
      const presentationUrl = window.location.href.replace('control.html', 'index.html');
      
      // First try to find existing window
      try {
        if (mainWindow && !mainWindow.closed) {
          return;
        }
      } catch (e) {
        // Window reference is stale
      }
      
      // Open new presentation window
      mainWindow = window.open(presentationUrl, 'presentation', 'width=1200,height=800');
      
      if (mainWindow) {
        document.getElementById('connection-status').textContent = 'Opening presentation...';
        
        // Wait for window to load
        mainWindow.onload = function() {
          setTimeout(() => {
            document.getElementById('connection-status').textContent = 'Connected';
            isConnected = true;
          }, 2000);
        };
      } else {
        document.getElementById('connection-status').textContent = 'Popup blocked - Please allow popups';
      }
    }
    
    function sendCommand(command, args = {}) {
      if (!mainWindow || mainWindow.closed) {
        connectToPresentation();
        return;
      }
      
      try {
        mainWindow.postMessage({
          type: 'reveal-control',
          command: command,
          args: args
        }, '*');
        document.getElementById('connection-status').textContent = 'Connected';
      } catch (e) {
        document.getElementById('connection-status').textContent = 'Connection error';
        mainWindow = null;
      }
    }

    function previousSlide() {
      sendCommand('prev');
    }

    function nextSlide() {
      sendCommand('next');
    }

    function upSlide() {
      sendCommand('up');
    }

    function downSlide() {
      sendCommand('down');
    }

    function firstSlide() {
      sendCommand('slide', { h: 0, v: 0 });
    }

    function lastSlide() {
      sendCommand('slide', { h: 13, v: 0 }); // Updated to match actual slide count
    }

    function toggleOverview() {
      sendCommand('toggleOverview');
    }

    function toggleBlackout() {
      sendCommand('togglePause');
    }

    function resetView() {
      sendCommand('slide', { h: 0, v: 0 });
    }

    function toggleNotes() {
      sendCommand('toggleNotes');
    }

    // Listen for presentation updates
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'reveal-state') {
        const state = event.data.state;
        document.getElementById('current-slide').textContent = (state.indexh + 1);
        document.getElementById('slide-title').textContent = state.slideTitle || 'Bull Team Presentation';
        document.getElementById('connection-status').textContent = 'Connected';
        isConnected = true;
      }
    });

    // Check connection status
    setInterval(() => {
      try {
        if (mainWindow && mainWindow.closed) {
          document.getElementById('connection-status').textContent = 'Presentation closed';
          mainWindow = null;
          isConnected = false;
        } else if (mainWindow && !isConnected) {
          document.getElementById('connection-status').textContent = 'Connecting...';
        }
      } catch (e) {
        // Handle cross-origin errors
        if (mainWindow) {
          document.getElementById('connection-status').textContent = 'Connected (cross-origin)';
        }
      }
    }, 2000);

    // Auto-connect on page load
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('connection-status').textContent = 'Ready to connect';
      setTimeout(connectToPresentation, 1000);
    });
    
    // Add manual connect button functionality
    document.querySelector('.link-section a[href="index.html"]').onclick = function(e) {
      e.preventDefault();
      connectToPresentation();
      return false;
    };
  </script>
</body>
</html>